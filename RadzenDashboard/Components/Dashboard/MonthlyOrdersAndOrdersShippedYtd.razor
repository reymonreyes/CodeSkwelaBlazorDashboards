@using BlazorDashboards.Services
@using BlazorDashboards.Services.Dtos
@using System.Globalization
<RadzenCard class="">
    <RadzenText>Monthly Orders Made/Orders Shipped YTD</RadzenText>
    @if (_isLoading)
    {
        <RadzenText TextAlign="TextAlign.Center">
            <RadzenProgressBar Value="100" ShowValue="false" Mode="ProgressBarMode.Indeterminate" AriaLabel="Loading progress" />
        </RadzenText>
    }
    else
    {
        <RadzenChart>
            <RadzenLegend Position="LegendPosition.Top"></RadzenLegend>
            <RadzenColumnSeries Data="@_monthlyOrders" LineType="LineType.Solid" ValueProperty="Total" CategoryProperty="MonthName" Title="Monthly Orders"></RadzenColumnSeries>
            <RadzenColumnSeries Data="@_monthlyOrdersShipped" LineType="LineType.Solid" ValueProperty="Total" CategoryProperty="MonthName" Title="Monthly Orders Shipped"></RadzenColumnSeries>            
        </RadzenChart>
    }
</RadzenCard>

@code {
    private List<MonthlyData> _monthlyOrders = new List<MonthlyData>();
    private List<MonthlyData> _monthlyOrdersShipped = new List<MonthlyData>();
    private bool _isLoading;

    private string FormatAsUSD(object value)
    {
        return ((double)value).ToString("C", CultureInfo.CreateSpecificCulture("en-US"));
    }

    protected override async Task OnInitializedAsync()
    {
        if (RendererInfo.IsInteractive)
        {
            _isLoading = true;
            var reportService = new ReportService();
            _monthlyOrders = await reportService.GetMonthlyOrdersYtd();
            _monthlyOrdersShipped = await reportService.GetMonthlyOrdersShippedYtd();
            _isLoading = false;
        }
    }
}

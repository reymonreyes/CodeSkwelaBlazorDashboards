@using BlazorDashboards.Services
@using BlazorDashboards.Services.Dtos

<RadzenCard class="">
    <RadzenText>Top 10 Products @DateTime.Now.ToString("MMMM yyyy")</RadzenText>
    @if (_isLoading)
    {
        <RadzenText TextAlign="TextAlign.Center">
            <RadzenProgressBar Value="100" ShowValue="false" Mode="ProgressBarMode.Indeterminate" AriaLabel="Loading progress" />
        </RadzenText>
    }
    else
    {
        <RadzenTable GridLines="DataGridGridLines.Both">
            <RadzenTableHeader>
                <RadzenTableHeaderRow>
                    <RadzenTableHeaderCell Style="width: 50px">#</RadzenTableHeaderCell>
                    <RadzenTableHeaderCell>Product</RadzenTableHeaderCell>
                    <RadzenTableHeaderCell>Total</RadzenTableHeaderCell>
                </RadzenTableHeaderRow>
            </RadzenTableHeader>
            <RadzenTableBody>
                @for (int i = 0; i < _top10Products.Count; i++)
                {
                    var row = i + 1;
                    var product = _top10Products[i];
                    <RadzenTableRow>
                        <RadzenTableCell>@row</RadzenTableCell>
                        <RadzenTableCell>@product.ProductName</RadzenTableCell>
                        <RadzenTableCell>@product.Total</RadzenTableCell>
                    </RadzenTableRow>
                }
            </RadzenTableBody>
        </RadzenTable>
    }
</RadzenCard>

@code {
    private List<ProductSales> _top10Products = new List<ProductSales>();
    private bool _isLoading;

    protected override async Task OnInitializedAsync()
    {
        if (RendererInfo.IsInteractive)
        {
            _isLoading = true;

            var reportService = new ReportService();
            _top10Products = await reportService.GetTop10ProductsOfMonth();

            _isLoading = false;
        }
    }
}
